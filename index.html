<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Gallery</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
        }
        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        video::-webkit-media-controls { display: none !important; }
        video { pointer-events: none; }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.15);
            border-left-color: #ffffff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .video-card {
            break-inside: avoid;
            margin-bottom: 1rem;
            background-color: #1C1C1C;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
    </style>
</head>
<body class="antialiased">
    <main class="min-h-screen w-full p-4 sm:p-6">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white">Video Gallery</h1>
        </header>

        <div id="links-grid" class="columns-1 sm:columns-2 md:columns-3 lg:columns-4 xl:columns-5 gap-4">
            <!-- Video cards will be dynamically added here -->
        </div>

        <div id="load-more-container" class="text-center mt-8">
            <button id="load-more-btn" class="hidden bg-white text-black font-bold py-3 px-8 rounded-lg hover:bg-gray-300 transition-colors duration-300">
                Load More
            </button>
        </div>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const linksGrid = document.getElementById('links-grid');
        const loadMoreBtn = document.getElementById('load-more-btn');

        let allVideoUrls = [];
        let currentIndex = 0;
        const initialLoadSize = 10;
        const batchSize = 5;
        const fileUrl = 'https://raw.githubusercontent.com/Aminoxdag/My-links/refs/heads/main/pomfblackedfull.txt';

        let activePreview = null;

        document.body.addEventListener('click', (e) => {
            if (activePreview && !activePreview.card.contains(e.target)) {
                activePreview.stop();
                activePreview = null;
            }
        });

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        async function fetchAndInitialize() {
            try {
                const response = await fetch(fileUrl);
                if (!response.ok) throw new Error(`Network response was not ok: ${response.status}`);
                
                const text = await response.text();
                const urls = text.split('\n').filter(url => url.trim() !== '');
                
                allVideoUrls = shuffleArray(urls);

                if (allVideoUrls.length > 0) {
                    loadMoreVideos(initialLoadSize);
                }

                if (currentIndex < allVideoUrls.length) {
                    loadMoreBtn.classList.remove('hidden');
                }
            } catch (error) {
                console.error("Failed to load video list:", error);
            }
        }

        function loadMoreVideos(count) {
            const batch = allVideoUrls.slice(currentIndex, currentIndex + count);
            batch.forEach(url => {
                const card = createLinkCard(url);
                linksGrid.appendChild(card);
            });
            currentIndex += count;

            if (currentIndex >= allVideoUrls.length) {
                loadMoreBtn.classList.add('hidden');
            }
        }
        
        loadMoreBtn.addEventListener('click', () => loadMoreVideos(batchSize));

        function createLinkCard(url) {
            const cardWrapper = document.createElement('div');
            cardWrapper.className = 'video-card relative rounded-lg overflow-hidden shadow-lg group';
            cardWrapper.style.cursor = 'pointer';
            
            const video = document.createElement('video');
            video.className = 'video-thumbnail transition-opacity duration-500 opacity-0';
            const randomThumbnailTime = Math.floor(Math.random() * 59) + 1;
            video.src = `${url}#t=${randomThumbnailTime}`;
            video.muted = true;
            video.playsInline = true;
            video.preload = 'metadata';

            const feedbackContainer = document.createElement('div');
            feedbackContainer.className = 'absolute inset-0 flex items-center justify-center';
            feedbackContainer.innerHTML = `<div class="spinner"></div>`;
            
            video.addEventListener('error', () => {
                cardWrapper.style.aspectRatio = '16 / 9';
                feedbackContainer.innerHTML = `<span class="text-xs text-red-400 text-center p-2">Load Error</span>`;
                cardWrapper.style.cursor = 'not-allowed';
            });

            video.addEventListener('loadedmetadata', () => {
                if (video.videoWidth > 0 && video.videoHeight > 0) {
                    cardWrapper.style.aspectRatio = `${video.videoWidth} / ${video.videoHeight}`;
                }
                feedbackContainer.style.display = 'none';
                video.classList.remove('opacity-0');
            });
            
            let pressTimer = null;
            let longPressed = false;

            const startPress = (e) => {
                 if (e.type === 'mousedown' && e.button !== 0) return;
                 longPressed = false;
                 pressTimer = setTimeout(() => {
                    longPressed = true;
                    e.stopPropagation();

                    if (activePreview && activePreview.video !== video) {
                        activePreview.stop();
                    }

                    if (activePreview && activePreview.video === video) {
                        activePreview.stop();
                        activePreview = null;
                    } else {
                        activePreview = {
                            video: video,
                            card: cardWrapper,
                            stop: function() {
                                this.video.pause();
                                this.video.loop = false;
                                this.video.muted = true;
                                this.video.controls = false;
                                this.video.style.pointerEvents = 'none';
                                this.card.classList.remove('z-20', 'transform', 'scale-105');
                                this.card.style.cursor = 'pointer';
                                video.currentTime = randomThumbnailTime;
                            }
                        };
                        video.loop = true;
                        video.muted = false;
                        video.controls = true;
                        video.style.pointerEvents = 'auto';
                        const startTime = Math.random() * Math.max(0, video.duration - 5);
                        video.currentTime = startTime;
                        video.play().catch(err => console.error("Preview play failed:", err));
                        cardWrapper.classList.add('z-20', 'transform', 'scale-105');
                        cardWrapper.style.cursor = 'default';
                    }
                 }, 500);
            };
            
            const cancelPress = () => {
                clearTimeout(pressTimer);
            };

            cardWrapper.addEventListener('mousedown', startPress);
            cardWrapper.addEventListener('mouseup', cancelPress);
            cardWrapper.addEventListener('mouseleave', cancelPress);
            cardWrapper.addEventListener('touchstart', startPress, { passive: true });
            cardWrapper.addEventListener('touchend', cancelPress);
            cardWrapper.addEventListener('touchcancel', cancelPress);
            
            cardWrapper.addEventListener('click', (e) => {
                if (longPressed) {
                    e.preventDefault();
                    e.stopPropagation();
                    return;
                }
                if (cardWrapper.style.cursor === 'pointer') {
                     window.open(url, '_blank', 'noopener,noreferrer');
                }
            });

            cardWrapper.appendChild(feedbackContainer);
            cardWrapper.appendChild(video);
            
            return cardWrapper;
        }
        
        fetchAndInitialize();
    });
    </script>
</body>
</html>

